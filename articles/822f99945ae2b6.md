---
title: "社内UIライブラリを作る"
emoji: "🎨"
publication_name: "wizleap_tech"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["vue", "react", "ui"]
published: false
---

## 経緯

弊社ではVue2+ElementUIを使っている（た）のですが、Vue3がリリースされたのでElement UIの依存解消（Element Plusへのマイグレーション）が必要になりました。

しかし過去の負債でElement UIに直接スタイリングをしてしまっていたり（たまにElement UIがそうするように推奨している場合もあった）して、単純にマイグレーションができる状況にはありませんでした。

## コンセプト

- 今後のVueやReact、もしくは新たなフレームワークが出てきたときにも対応できるようにする。
- UI開発に必要な知識(HTML/CSS)に精通していないメンバーでもフロントエンドの開発に参加できるようにする。
- Vue2 -> Vue3のマイグレーションを限りなく0コストにする。 

## 開発環境

VueとReactの両方で開発できるように、TypeScriptで開発します。

### Component Catalog

つい最近Storybook V7がリリースされましたが、開発初めの段階ではV7はbeta版でした。
ですが、V7ではvite-builderが使えるようになったり、Storybookが複数のフレームワークを持つmonorepoで管理しやすいようになったりと、開発体験が大幅に向上しているので、V7を使うことにしました。

詳細はこちらの記事を参照して下さい。
https://zenn.dev/sterashima78/articles/3ae177ebc06bc5

### Styling

CSSをそのまま書くと型がなく開発体験が悪いので、今回はZero-Runtime CSS-in-JSライブラリである[Vanilla Extract](https://vanilla-extract.style/)を使いました。
「いやスタイリングでライブラリ使うんかい」と思われるかもしれませんが、VE自体はビルド時にCSSに変換されるので実行時にはCSSを読み込むだけで済みますし、プラグイン型でフロントFWに依存しないのでVue/Reactのどちらでも使えます。
また、Storybookでカタログベースの開発環境を作ります。

## 工夫したこと

### Monorepo

Monorepoで管理することで、共通のコードを共有できるようになります。
今あるpackageは以下の通りです。

- packages/
  - wiz-ui-styles (VE)
  - wiz-ui-icons (SVG + generator)
  - wiz-ui-utils (Functions)
  - wiz-ui-constants (Color Tokens, Size Tokens, etc.)
  - vuepress-plugin-wiz-ui (Vue2) [ARCHIVED]
  - wiz-ui (vue2)
  - wiz-ui-next (vue3)
  - wiz-ui-react (react)
- examples/
  - vue2 (Vue2)
  - vue3 (Vue3)
- docs
  - vuepress (Vue2) [ARCHIVED]

このように、UIライブラリとそれを使ったサンプルアプリケーションを一元管理することで、UIライブラリの開発とサンプルアプリケーションの開発を同時に行うことができます。
また、管理にはpnpmとturborepo、リリースにはchangesetを使っています。

VercelなどのCI連携サービスを使えばStorybookのPR単位のデプロイがとても楽にできるのですが、弊社の意向でAWSで統一したいとのことでしたので、自動デプロイシステムはCloudfront + WAF + S3で自作しました。

Changesetについてもなかなか苦戦したのでそのうち記事にします。

### CI

CIを強固にして、ライブラリの品質を担保します。
導入したものは以下の通りです。

- Lint (ESLint)
- Test
  - Unit Test (Vitest)
  - Visual Regression Test (Storybook, Reg-Suit)
- Build (Bundle Analyzer)
- Publish (Changeset)

特にVisual Regression Testは、Storybookで作成したコンポーネントのスナップショットを取り、変更があった場合にはPR上で確認できるようにしています。
これによって意図しないデザイン崩れを防ぎながら開発できます。

### Icons

Iconはgoogleのmaterial design iconsから持ってきたSVGをこれまたprivate packageのicon-generatorでそれぞれのフレームワークのフォーマットに変換して出力しています。
基本はSVGをそのままHTMLに埋め込む形ですが、外部からサイズ等を変更できるように拡張しています。
