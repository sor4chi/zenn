---
title: "Vue2.7ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã™ã‚‹éš›ã¯composition-apiã®root(ç‰¹ã«vue-router)ã«æ³¨æ„ï¼"
emoji: "ğŸƒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["vue", "vuerouter", "compositionapi"]
published: true
---

Vue2.6 ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ Vue3 ã¸ã¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦ã„ã‚‹æ®µéšã§å…ˆæ—¥ Vue3 ã®ç’°å¢ƒã«ã‹ãªã‚Šè¿‘ã¥ã‘ãŸ Vue2 æœ€æ–°ã®[Vue2.7](https://blog.vuejs.org/posts/vue-2-7-naruto.html)ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã€‚

Vue2.6 ã¾ã§ã¯ `@vue/composition-api` ã‚’ä½¿ã†ã“ã¨ã§ Vue2 ã§ã‚‚ Composition API è¨˜æ³•ã‚’ä½¿ã†ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ã—ã‹ã— Vue2.7 ä»¥é™ã¯ãƒã‚£ãƒ†ã‚£ãƒ–ã§ Composition API è¨˜æ³•ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œ `@vue/composition-api` ã‚’ä½¿ã†å¿…è¦ãŒãªããªã‚Šã¾ã—ãŸã€‚
ãã—ã¦ `script setup` è¨˜æ³•ã‚‚ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚

# çµè«–

Vue2 å‘ã‘ Vue Router ã®æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã‹ã‚‰ã€root ã‚’çµŒç”±ã—ãªãã¦ã‚‚ `useRoute`ãƒ»`useRouter` ã‚’ä½¿ã£ã¦ VueRouter ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã›ã‚‹ã‚ˆï¼

# èƒŒæ™¯

Vue2.6 ä»¥å‰ã§@vue/composition-api ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹æ™‚ã¯ setup é–¢æ•°ã®ç¬¬äºŒå¼•æ•°ï¼ˆcontextï¼‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦ root ã‚’ã¨ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ã“ã® root ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§ vue ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãŸã‚ã€vue-router[^1]ç­‰ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£(`$` è¡¨è¨˜ã®ãƒ¡ã‚½ãƒƒãƒ‰)ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã—ãŸã€‚

ä¾‹ï¼‰

```ts
export default defineComponent ({
  setup(_, { root }) {
    root.$router.push('/home') // vue-routerã®pushãƒ¡ã‚½ãƒƒãƒ‰
    root.$store.dispatch('action') // vuexã®dispatchãƒ¡ã‚½ãƒƒãƒ‰
    root.$axios.get('/api') // axiosã®getãƒ¡ã‚½ãƒƒãƒ‰
  }
})
```

# @vue/composition-apiã‹ã‚‰ã®Vue2.7ã¸ã®ç§»è¡Œã«ä¼´ã†æ³¨æ„ç‚¹

ã—ã‹ã—ã€Vue2.7 ä»¥é™åŠã³ Vue3 ä»¥é™ã«ãŠã„ã¦ã¯ root ãŒå¼•æ•°ã‹ã‚‰å‰Šé™¤ã•ã‚Œã¦ãŠã‚Šã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ããªããªã‚Šã¾ã—ãŸã€‚
ãã®ãŸã‚ã€ä»–ã®æ–¹æ³•ã§ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ä¸Šè¨˜ã®ä¾‹ã§ã‚ã‚Œã°ã€store ã ã¨ Vuex.Store ã‚’ store module ã¨ã—ã¦ Export ã™ã‚‹ã“ã¨ã§ã€ãã®ã¾ã¾å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ import ã—ã¦ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚

## VueRouterã®å ´åˆ

Vue3 å¯¾å¿œã® vue-router@next ã§ã¯å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ `useRoute`ãƒ»`useRouter` ãŒæä¾›ã•ã‚Œã¦ãŠã‚Šã€ä½¿ã†å´ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚
ã—ã‹ã— root ã‹ã‚‰å–ã‚Œã‚‹ã®ã§ã¨ vue-router@3 ã§ã¯ã“ã®é–¢æ•°ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚

ãã“ã§å…ˆæ—¥ã“ã®ã‚ˆã†ãª Issue ãŒç«‹ã¦ã‚‰ã‚Œã€Vue2 ç³»ã® vue-router@3 ã«ãŠã„ã¦ã‚‚åŒæ§˜ã« `useRoute`ãƒ»`useRouter` ã‚’æä¾›ã—ã‚ˆã†ã¨ã„ã†å‹•ããŒã‚ã‚Šã¾ã—ãŸã€‚

https://github.com/vuejs/vue-router/issues/3760

ãã—ã¦ã¤ã„æ˜¨æ—¥ã€ã“ã® Issue ã«å¯¾ã—ã¦ Pull Request ãŒãƒãƒ¼ã‚¸ã•ã‚Œã€Eduardo æ°æ›°ãæœ€å¾Œã®ãƒã‚¤ãƒŠãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ãªã‚‹[vue-router@3.6](https://github.com/vuejs/vue-router/blob/dev/CHANGELOG.md)ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€`@vue/composition-api` / Vue2.7 ã«é™ã‚‰ãš Vue2 ã§ã‚‚ `root` ã‚’ä½¿ã‚ãªã„ã§ VueRouter ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

ä¾‹ï¼‰

```ts
import { useRouter, useRoute } from 'vue-router/composables'

export default defineComponent ({
  setup() {
    const router = useRouter()
    const route = useRoute()
    router.push('/home')
    const currentId = route.params.id
  }
})
```

ãŸã ä¾å­˜é–¢ä¿‚ã®å•é¡Œã§ã©ã†ã—ã¦ã‚‚ vue-router ã® version ã‚’ä¸Šã’ã‚‹ã“ã¨ãŒã§ããªã„ã¨ã„ã†æ–¹ã¸ã€vue-router ãŒ 2.7 ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã¾ã§åˆ©ç”¨ã—ã¦ã„ãŸå¦¥å”æ¡ˆã‚’æ®‹ã—ã¦ãŠãã¾ã™ã€‚
ãã†ã„ã†å ´åˆã¯ vue ã® getCurrentInstance()ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã†ã“ã¨ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ã `useRoute`ãƒ»`useRouter` ã‚’ä»®ã«è‡ªä½œã§ãã¾ã™ã€‚
current ã‚’å‚ç…§ã—ã¦ã„ã‚‹ã ã‘ã§ã™ã®ã§å®Ÿéš›ã« Route ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç›£è¦–ã¯ã§ããšã€ä¸å®‰å®šæŒ™å‹•ã‚’ç¤ºã™æã‚ŒãŒã‚ã‚‹ãŸã‚å‹•ä½œã®ä¿è¨¼ã¯ã§ãã¾ã›ã‚“ãŒä¸€å¿œã“ã®æ–¹æ³•ã§ã‚‚è‡ªåˆ†ã®ç’°å¢ƒã§ã¯å‹•ãã¾ã—ãŸã€‚

```ts
import { computed, reactive, getCurrentInstance } from "vue";
import VueRouter, { Route } from "vue-router";

declare module "vue/types/vue" {
  interface Vue {
    $router: VueRouter;
    $route: Route;
  }
}

export const useRouter = () => {
  const instance = getCurrentInstance();
  if (!instance) return {} as VueRouter;
  return instance.proxy.$router;
}

export const useRoute = () => {
  const instance = getCurrentInstance();
  if (!instance) return {} as Route;
  const currentRoute = computed(() => instance.proxy.$route);

  const protoRoute = Object.keys(currentRoute.value).reduce((acc, key) => {
    acc[key] = computed(() => currentRoute.value[key]);
    return acc;
  }, {});

  return reactive(protoRoute) as Route;
}
```

[^1]: [Vue Composition API ã¨ Vue 3 ã§ã®å®Ÿè£…æ–¹æ³•ã®é•ã„ã«ã¤ã„ã¦ - Vue Composition API ã§ URLé·ç§»ã‚’ã™ã‚‹å ´åˆ](https://zenn.dev/okakyo/articles/9df4fe85c9735f#vue-composition-api-%E3%81%A7-url%E9%81%B7%E7%A7%BB%E3%82%92%E3%81%99%E3%82%8B%E5%A0%B4%E5%90%88)
